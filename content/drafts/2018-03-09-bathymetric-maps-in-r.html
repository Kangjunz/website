---
title: Bathymetric maps in R
author: Hansen Johnson
date: '2018-06-09'
slug: bathymetric-maps-in-r
categories:
  - R
tags:
  - plots
---



<p>There are many, many ways to make maps in R. In the last year or so I’ve become a big fan of leaflet and the R package <code>rleaflet</code> that makes these maps a breeze to build in R. Leaflet makes pretty online interactive maps, but doesn’t provide a great option for a static map like you would put in a publication. I’ve jumped around between a few different methods for making static maps, and have found it difficult to settle on one in particular. I’ve talked to a few friends about this and they’ve had similar issues, so I thought it’d be worth digging a little deeper. My plan for this post is to review and compare a few different options for making static maps in R. I’m going to focus on making maps for my own work (oceanography), which usually include some combination of contours (bathymetry), lines, points, and polygons.</p>
<p>Here are the different packages I’ll be using: * <code>marmap</code> * image * plain * <code>oce</code> * projected * not projected * <code>ggmap</code></p>
<div id="get-data" class="section level2">
<h2>Get data</h2>
<p>Step one is to get the data that we’ll be plotting.</p>
<pre class="r"><code># get bathymetry data
library(marmap, warn.conflicts = F, quietly = T)
b = getNOAA.bathy(lon1 = -68, lon2 = -62, lat1 = 40, lat2 = 44, resolution = 1) </code></pre>
<pre><code>## Querying NOAA database ...
## This may take seconds to minutes, depending on grid size
## Building bathy matrix ...</code></pre>
<pre class="r"><code># get trackline data
lon = c(-65.17536, -65.37423, -65.64541, -66.06122, -66.15161)
lat = c(43.30837, 42.94679, 42.87448, 42.92871, 42.72985)
lin = cbind.data.frame(lon, lat)

# get point data (a few random points)
lon = c(-65.3, -65.7, -64.1)
lat = c(43.4, 43, 42.9)
pts = cbind.data.frame(lon, lat)

# get polygon data (roseway basin critical habitat area)
ply = rbind.data.frame(c(-64.916667, 43.266667),
      c(-64.983333, 42.783333),
      c(-65.516667, 42.65),
      c(-66.083333, 42.866667))
colnames(ply) = c(&#39;lon&#39;, &#39;lat&#39;)</code></pre>
</div>
<div id="marmap" class="section level2">
<h2>marmap</h2>
<pre class="r"><code># basic marmap
plot(b)
points(pts, pch = 16, col = &#39;red&#39;)
lines(lin, col = &#39;blue&#39;)
polygon(ply, lty = 2)</code></pre>
<p><img src="/drafts/2018-03-09-bathymetric-maps-in-r_files/figure-html/marmap-1.png" width="672" /></p>
<pre class="r"><code># improved bathymetric contours

plot(b, deepest.isobath = -200, shallowest.isobath = -50, step = 50, drawlabels = T, land = F, lwd = 0.1)
plot(b, deep = 0, shallow = 0, step = 0, lwd = 1, add = TRUE)

points(pts, pch = 16, col = &#39;red&#39;)
lines(lin, col = &#39;blue&#39;)
polygon(ply, lty = 2)</code></pre>
<p><img src="/drafts/2018-03-09-bathymetric-maps-in-r_files/figure-html/marmap-2.png" width="672" /></p>
<pre class="r"><code># coloured image

# Creating a custom palette of blues
blues &lt;- c(&quot;lightsteelblue4&quot;, &quot;lightsteelblue3&quot;,
&quot;lightsteelblue2&quot;, &quot;lightsteelblue1&quot;)

plot(b, deepest.isobath = -200, shallowest.isobath = -50, step = 50, drawlabels = T, land = T, lwd = 0.1,
     bpal = list(c(0, max(b), &quot;grey&quot;), c(min(b),0,blues)), image = T)
plot(b, deep = 0, shallow = 0, step = 0, lwd = 1, add = TRUE)

points(pts, pch = 16, col = &#39;red&#39;)
lines(lin, col = &#39;blue&#39;)
polygon(ply, lty = 2)</code></pre>
<p><img src="/drafts/2018-03-09-bathymetric-maps-in-r_files/figure-html/marmap-3.png" width="672" /></p>
<p>The <code>marmap</code> package has a lot of useful tools (particularly <code>getNOAA.bathy()</code>), but I’ve never quite been satisfied with the look of the maps. My biggest issue is that the margins of the plot are never clean.</p>
</div>
<div id="oce" class="section level2">
<h2>oce</h2>
<pre class="r"><code>library(oce)</code></pre>
<pre><code>## Loading required package: gsw</code></pre>
<pre><code>## Loading required package: testthat</code></pre>
<pre><code>## 
## Attaching package: &#39;oce&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:marmap&#39;:
## 
##     plotProfile</code></pre>
<pre class="r"><code>library(ocedata)
data(&quot;coastlineWorldFine&quot;)

# convert bathy
bathyLon = as.numeric(rownames(b))
bathyLat = as.numeric(colnames(b))
bathyZ = as.numeric(b)
dim(bathyZ) = dim(b)
# bathyZ[bathyZ &gt; 0] = NA # to blank out the land

# plotting region
mlon = mean(ply$lon)
mlat = mean(ply$lat)
span = 300

# unprojected

# plot coastline
plot(coastlineWorldFine, clon = mlon, clat = mlat, span = span)

# plot bathymetry
contour(bathyLon,bathyLat,bathyZ,levels = c(-50, -100, -150, -200, -250),lwd = c(1, 1, 2, 2, 3),lty = c(3, 1, 3, 1, 3),drawlabels = F,add = TRUE,col = &#39;darkgray&#39;)

# add depth legend
legend(&quot;bottomright&quot;,lwd = c(1, 1, 2, 2, 3),lty = c(3, 1, 3, 1, 3),col = &#39;darkgray&#39;,seg.len = 3,cex = 0.8,title = &quot;Depth [m]&quot;,legend = c(&quot;50&quot;, &quot;100&quot;, &quot;150&quot;, &quot;200&quot;, &quot;250&quot;),bg= &quot;white&quot;)

points(pts, pch = 16, col = &#39;red&#39;)
lines(lin, col = &#39;blue&#39;)
polygon(ply, lty = 2)</code></pre>
<p><img src="/drafts/2018-03-09-bathymetric-maps-in-r_files/figure-html/oce-1.png" width="672" /></p>
<pre class="r"><code># projected

# plot coastline
plot(coastlineWorldFine, clon = mlon, clat = mlat, span = 200, projection=&quot;+proj=merc&quot;)

# plot bathymetry
mapContour(bathyLon,bathyLat,bathyZ,levels = c(-50, -100, -150, -200, -250),lwd = c(1, 1, 2, 2, 3),lty = c(3, 1, 3, 1, 3),col = &#39;darkgray&#39;)

# add depth legend
legend(&quot;bottomright&quot;,lwd = c(1, 1, 2, 2, 3),lty = c(3, 1, 3, 1, 3),col = &#39;darkgray&#39;,seg.len = 3,cex = 0.7,title = &quot;Depth [m]&quot;,legend = c(&quot;50&quot;, &quot;100&quot;, &quot;150&quot;, &quot;200&quot;, &quot;250&quot;),bg= &quot;white&quot;)

mapPoints(longitude = pts$lon, latitude = pts$lat, pch = 16, col = &#39;red&#39;)
mapLines(longitude = lin$lon, latitude = lin$lat, col = &#39;blue&#39;)
mapPolygon(longitude = ply$lon, latitude = ply$lat, lty = 2)</code></pre>
<p><img src="/drafts/2018-03-09-bathymetric-maps-in-r_files/figure-html/oce-2.png" width="672" /></p>
</div>
<div id="ggmap" class="section level2">
<h2>ggmap</h2>
</div>
